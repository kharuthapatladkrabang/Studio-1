<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Studio 1</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <style>
        /* CSS üé® UI Design: Modern gradient with glassmorphism */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Prompt', sans-serif;
            min-height: 100vh;
            /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á: Red gradient (#ff0000 to #8b0000) */
            background: linear-gradient(135deg, #ff0000 0%, #8b0000 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto; /* Mobile responsive */
        }

        .container {
            width: 100%;
            max-width: 500px;
            /* Glassmorphism: Background 60% white blur */
            background: rgba(255, 255, 255, 0.6); 
            border-radius: 20px;
            padding: 40px 30px;
            backdrop-filter: blur(10px); /* Glassmorphism effect */
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            animation: fadeIn 0.5s ease-out;
            color: #fff; /* ‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            text-align: center;
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 30px;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 15px;
            font-weight: 500;
            color: #fff; /* Label ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */
            margin-bottom: 8px;
        }

        label span {
            color: #ffdddd; /* Lighter red for emphasis */
        }

        /* Input, Select, File Button Base Style (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å index (20).html) */
        input:not([type="file"]), select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            background: #ffffff; /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */
            border-radius: 10px;
            font-family: 'Prompt', sans-serif;
            font-size: 16px;
            transition: all 0.3s ease;
            color: #333; /* ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏° */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        input:focus, select:focus {
            outline: none;
            background: white;
            /* ‡∏™‡∏µ‡πÄ‡∏ô‡πâ‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏î‡∏á‡πÄ‡∏Ç‡πâ‡∏°/‡∏ä‡∏°‡∏û‡∏π ‡∏ï‡∏≤‡∏° theme */
            border-color: #dc2743; 
            box-shadow: 0 0 0 3px rgba(220, 39, 67, 0.2);
        }

        input::placeholder {
            color: #999;
            font-weight: 300;
        }
        
        /* Toggle Button Styling (Liquid Effect) */
        .toggle-container {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .btn {
            flex-grow: 1;
            position: relative;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            color: #fff; /* ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏õ‡∏Å‡∏ï‡∏¥‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */
            background: none;
            border: 2px solid;
            border-radius: 8px;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.3s ease;
            font-family: 'Prompt', sans-serif !important;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 1;
        }
        
        .btn.‡πÄ‡∏Ç‡πâ‡∏≤ { border-color: #27ae60; }
        .btn.‡∏≠‡∏≠‡∏Å { border-color: #c0392b; }
        
        .liquid {
            /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏Ç‡∏≠‡∏á Liquid Fill ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏∏‡πà‡∏° */
            /* Default: (‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏´‡πá‡∏ô) */
            background: linear-gradient(#646cff 0 0) no-repeat calc(200% - var(--p, 0%)) 100% / 200% var(--p, 0.2em);
            transition: 0.3s var(--t, 0s), background-position 0.3s calc(0.3s - var(--t, 0s));
        }

        .btn.‡πÄ‡∏Ç‡πâ‡∏≤.liquid { 
            background: linear-gradient(#27ae60 0 0) no-repeat calc(200% - var(--p, 0%)) 100% / 200% var(--p, 0.2em); 
        }
        
        .btn.‡∏≠‡∏≠‡∏Å.liquid { 
            background: linear-gradient(#c0392b 0 0) no-repeat calc(200% - var(--p, 0%)) 100% / 200% var(--p, 0.2em); 
        }
        
        .liquid:hover, .liquid.active {
            --p: 100%;
            --t: 0.3s;
            color: #fff; /* ‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡πÄ‡∏°‡∏∑‡πà‡∏≠ active */
        }


        /* File Input Styling (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å Input style) */
        .file-upload-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .file-upload-wrapper input[type="file"] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }

        .file-upload-button {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            background: #ffffff; /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */
            color: #333;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            text-align: left;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏ü‡∏Å‡∏±‡∏™ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Input ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ) */
        .file-upload-wrapper:focus-within .file-upload-button {
            border-color: #dc2743;
            box-shadow: 0 0 0 3px rgba(220, 39, 67, 0.2);
        }

        #file-name-display {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 80%;
            color: #333;
        }

        /* Image Preview */
        #image-preview-container {
            margin-top: 15px;
            text-align: center;
            border: 2px dashed rgba(255, 255, 255, 0.5);
            border-radius: 10px;
            padding: 10px;
            display: none;
            background: rgba(0, 0, 0, 0.2);
        }

        #image-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            object-fit: contain;
        }

        /* Submit Button (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å index (20).html) */
        button[type="submit"] {
            width: 100%;
            padding: 14px;
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            color: white;
            border: none;
            border-radius: 10px;
            font-family: 'Prompt', sans-serif;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            /* Box Shadow ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° */
            box-shadow: 0 4px 15px rgba(220, 39, 67, 0.3);
        }

        button[type="submit"]:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(220, 39, 67, 0.4);
            background: linear-gradient(45deg, #ff4b2b, #ff416c);
        }

        button[type="submit"]:active:not(:disabled) {
            transform: translateY(0);
        }

        button[type="submit"]:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Loading animation ‚öôÔ∏è */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1000;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #loading-overlay p {
            color: white;
            font-weight: 300;
            margin-top: 15px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Studio 1</h1>
        
        <form id="registrationForm">

            <!-- 1. ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Toggle Button) -->
            <label for="type">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô <span>*</span></label>
            <div class="toggle-container" id="type-toggle-container">
                <button type="button" class="btn liquid ‡πÄ‡∏Ç‡πâ‡∏≤" data-value="‡πÄ‡∏Ç‡πâ‡∏≤" onclick="toggleActivate(this)"><span>‡πÄ‡∏Ç‡πâ‡∏≤</span></button>
                <button type="button" class="btn liquid ‡∏≠‡∏≠‡∏Å" data-value="‡∏≠‡∏≠‡∏Å" onclick="toggleActivate(this)"><span>‡∏≠‡∏≠‡∏Å</span></button>
                <input type="hidden" id="type" name="type" required>
            </div>
            
            <!-- 2. ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ -->
            <div class="form-group">
                <label for="studentId">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ <span>*</span></label>
                <input type="number" id="studentId" name="studentId" required placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤">
            </div>

            <!-- 3. ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ -->
            <div class="form-group">
                <label for="phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ <span>*</span></label>
                <input type="tel" id="phone" name="phone" required pattern="[0-9]{10}" placeholder="08XXXXXXXX" maxlength="10">
            </div>

            <!-- 4. ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô -->
            <div class="form-group" id="count-group">
                <label for="count">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô <span>*</span></label>
                <input type="number" id="count" name="count" required min="1" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°/‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢">
            </div>

            <!-- 5. ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (Optional) -->
            <div class="form-group">
                <label for="file">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (JPG/PNG ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10MB)</label>
                <div class="file-upload-wrapper">
                    <!-- ‡∏•‡∏ö required ‡∏≠‡∏≠‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô Optional -->
                    <input type="file" id="file" name="file" accept=".jpg, .jpeg, .png" onchange="previewImage(event)"> 
                    <div class="file-upload-button">
                        <span id="file-name-display">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...</span>
                        <span style="font-size: 1.2em; color: #999;">üìé</span>
                    </div>
                </div>
                <div id="image-preview-container">
                    <img id="image-preview" src="#" alt="Image Preview" style="display:none;">
                </div>
            </div>

            <button type="submit" id="submitBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </form>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="spinner"></div>
        <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
    </div>

    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        // URL ‡∏Ç‡∏≠‡∏á Web App (‡∏ó‡∏µ‡πà Deploy ‡πÅ‡∏•‡πâ‡∏ß)
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyccfJLBCeKj09sZqRIHmf517SDmxzua2AMRM2OPxmiHMRi_gsg5U2axE6AuKDR4PMr/exec';
        
        // Google Sheet API Key (‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Write)
        const API_KEY = 'AIzaSyCa6APxh8sr1RPTlcZStt4UWnjXjZ-q8Vw'; 

        // --- Utility Functions ---
        function showSwal(icon, title, text) {
            Swal.fire({
                icon: icon,
                title: title,
                text: text,
                confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á'
            });
        }

        // --- Toggle Button Function ---
        function toggleActivate(btn) {
            document.querySelectorAll('.toggle-container .btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const typeValue = btn.getAttribute('data-value');
            document.getElementById('type').value = typeValue;

            const countGroup = document.getElementById('count-group');
            const countInput = document.getElementById('count');

            if (typeValue === '‡∏≠‡∏≠‡∏Å') {
                // ‡∏ã‡πà‡∏≠‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å '‡∏≠‡∏≠‡∏Å'
                countGroup.style.display = 'none';
                countInput.removeAttribute('required');
                countInput.value = 1; // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
            } else {
                // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å '‡πÄ‡∏Ç‡πâ‡∏≤'
                countGroup.style.display = 'block';
                countInput.setAttribute('required', 'required');
                countInput.value = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°
            }
        }

        // --- Image Preview and File Validation ---
        function previewImage(event) {
            const fileInput = event.target;
            const file = fileInput.files[0];
            const previewContainer = document.getElementById('image-preview-container');
            const preview = document.getElementById('image-preview');
            const fileNameDisplay = document.getElementById('file-name-display');
            
            // Reset state
            preview.style.display = 'none';
            preview.src = '#';
            previewContainer.style.display = 'none';

            if (file) {
                fileNameDisplay.textContent = file.name;

                // 1. File size validation (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10 MB)
                const maxSize = 10 * 1024 * 1024;
                if (file.size > maxSize) {
                    showSwal('error', '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10 MB');
                    fileInput.value = ''; // Clear file input
                    fileNameDisplay.textContent = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...';
                    return;
                }

                // 2. File type validation (jpg/png ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
                const validTypes = ['image/jpeg', 'image/png'];
                if (!validTypes.includes(file.type)) {
                    showSwal('error', '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå JPG ‡πÅ‡∏•‡∏∞ PNG ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
                    fileInput.value = ''; // Clear file input
                    fileNameDisplay.textContent = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...';
                    return;
                }
                
                // Show preview
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    previewContainer.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                fileNameDisplay.textContent = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...';
            }
        }

        // --- Main Submission Handling ---
        document.getElementById('registrationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const form = e.target;
            const submitBtn = document.getElementById('submitBtn');
            const loadingOverlay = document.getElementById('loading-overlay');
            const fileInput = document.getElementById('file');
            const file = fileInput.files[0];
            
            // 1. Validate required fields (HTML5 handles most, but check hidden type)
            if (!document.getElementById('type').value) {
                showSwal('error', '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
                return;
            }

            // 2. Phone validation (10 digits)
            const phone = document.getElementById('phone').value;
            if (phone.length !== 10 || isNaN(phone)) {
                showSwal('error', '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 10 ‡∏´‡∏•‡∏±‡∏Å');
                return;
            }
            
            // Disable button and show loading
            submitBtn.disabled = true;
            loadingOverlay.style.display = 'flex';

            const formData = new FormData(form);
            const data = {};
            
            // Convert form data to object
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }

            // 3. File handling: Convert to base64 before sending
            if (file) {
                try {
                    const base64Data = await readFileAsBase64(file);
                    data.fileBase64 = base64Data.split(',')[1]; // Base64 part
                    data.fileName = file.name;
                    data.fileMimeType = file.type;
                } catch (error) {
                    showSwal('error', '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ: ' + error.message);
                    submitBtn.disabled = false;
                    loadingOverlay.style.display = 'none';
                    return;
                }
            }
            
            // 4. Send data to Google Apps Script
            sendDataToAppsScript(data);
        });
        
        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        async function sendDataToAppsScript(data) {
            const submitBtn = document.getElementById('submitBtn');
            const loadingOverlay = document.getElementById('loading-overlay');

            try {
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Header ‡πÄ‡∏õ‡πá‡∏ô JSON ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Code.gs ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                    headers: { 'Content-Type': 'application/json' }, 
                    body: JSON.stringify(data),
                });
                
                // GAS Web App ‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞‡∏™‡πà‡∏á Header CORS ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                
                // Handle response from Apps Script
                handleResponse(result);

            } catch (error) {
                console.error('Submission Error:', error);
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö CORS/Connection Error
                handleResponse({ 
                    success: false, 
                    message: `‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Web App. ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£ Deploy: ${error.message}`
                });
            }
        }
        
        // --- Response Handler ---
        function handleResponse(result) {
            const submitBtn = document.getElementById('submitBtn');
            const loadingOverlay = document.getElementById('loading-overlay');
            const form = document.getElementById('registrationForm');
            const fileInput = document.getElementById('file');
            const previewContainer = document.getElementById('image-preview-container');
            const preview = document.getElementById('image-preview');
            const fileNameDisplay = document.getElementById('file-name-display');

            loadingOverlay.style.display = 'none';
            submitBtn.disabled = false;

            if (result && result.success) {
                showSwal('success', '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', result.message);
                
                // Reset form after success
                form.reset();
                document.getElementById('type').value = '';
                document.querySelectorAll('.toggle-container .btn').forEach(b => b.classList.remove('active'));
                
                // Reset file preview
                fileInput.value = '';
                preview.style.display = 'none';
                preview.src = '#';
                previewContainer.style.display = 'none';
                fileNameDisplay.textContent = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...';
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏° '‡πÄ‡∏Ç‡πâ‡∏≤'/'‡∏≠‡∏≠‡∏Å' ‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏ì‡∏µ reset)
                const countGroup = document.getElementById('count-group');
                const countInput = document.getElementById('count');
                countGroup.style.display = 'block';
                countInput.setAttribute('required', 'required');

            } else if (result && !result.success) {
                // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° error ‡∏à‡∏≤‡∏Å GAS Backend ‡∏´‡∏£‡∏∑‡∏≠ Error ‡∏à‡∏≤‡∏Å catch block
                showSwal('error', '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á', result.message);
            } else {
                 showSwal('warning', '‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô', '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö');
            }
        }

    </script>
</body>
</html>
