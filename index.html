<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Studio 1</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- SweetAlert2 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <style>
        /* CSS üé® UI Design: Modern gradient with glassmorphism */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Prompt', sans-serif;
            min-height: 100vh;
            /* ‡∏™‡∏µ‡∏´‡∏•‡∏±‡∏Å: Red gradient (#ff0000 to #8b0000) */
            background: linear-gradient(135deg, #ff0000 0%, #8b0000 100%); 
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-y: auto; /* Mobile responsive */
        }

        .container {
            width: 100%;
            max-width: 500px;
            /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏Ç‡∏∏‡πà‡∏ô 60% (Glassmorphism) */
            background: rgba(255, 255, 255, 0.6); 
            border-radius: 20px;
            padding: 40px 30px;
            /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÄ‡∏ö‡∏•‡∏≠ */
            backdrop-filter: blur(10px); 
            /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏á‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÅ‡∏™‡∏á */
            border: 1px solid rgba(255, 255, 255, 0.3); 
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            animation: fadeIn 0.5s ease-out;
            /* ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */
            color: #fff; 
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            text-align: center;
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 30px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5); 
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            font-size: 15px;
            font-weight: 500;
            color: #fff; /* ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */
            margin-bottom: 8px;
        }

        label span {
            color: #ffdddd; /* ‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏≠‡∏°‡∏ä‡∏°‡∏û‡∏π‡∏≠‡πà‡∏≠‡∏ô */
        }

        input:not([type="file"]), select {
            width: 100%;
            padding: 12px 16px;
            /* CHANGE: ‡πÉ‡∏ä‡πâ Border 2px ‡∏™‡∏µ‡∏≠‡πà‡∏≠‡∏ô ‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á (index 20) */
            border: 2px solid #e0e0e0; 
            /* ‡∏≠‡∏¥‡∏ô‡∏û‡∏∏‡∏ï‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏ó‡∏∂‡∏ö */
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            font-family: 'Prompt', sans-serif;
            font-size: 16px;
            transition: all 0.3s ease;
            color: #333; /* ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÉ‡∏ô Input ‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏° */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        input:focus, select:focus {
            outline: none;
            background: white;
            /* CHANGE: Focus Border ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏Ç‡πâ‡∏° ‡∏ï‡∏≤‡∏° Theme (‡∏Ñ‡∏•‡πâ‡∏≤‡∏¢ index 20) */
            border-color: #dc2743; 
            box-shadow: 0 0 0 3px rgba(220, 39, 67, 0.3);
        }

        input::placeholder {
            color: #999;
            font-weight: 300;
        }
        
        /* --- START Toggle Button Styling --- */
        .toggle-container {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
        }

        .btn {
            flex-grow: 1;
            position: relative;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            color: #fff; /* ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */
            background: none;
            border: 2px solid;
            border-radius: 8px;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.3s ease;
            font-family: 'Prompt', sans-serif !important;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        /* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ Border ‡∏Ç‡∏≠‡∏á ‡πÄ‡∏Ç‡πâ‡∏≤ (‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏î‡∏¥‡∏°) */
        .btn.‡πÄ‡∏Ç‡πâ‡∏≤ { border-color: #27ae60; }
        /* ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏™‡∏µ Border ‡∏Ç‡∏≠‡∏á ‡∏≠‡∏≠‡∏Å ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏Ç‡πâ‡∏° */
        .btn.‡∏≠‡∏≠‡∏Å { border-color: #c0392b; } 

        .liquid {
            background: linear-gradient(#646cff 0 0) no-repeat calc(200% - var(--p, 0%)) 100% / 200% var(--p, 0.2em);
            transition: 0.3s var(--t, 0s), background-position 0.3s calc(0.3s - var(--t, 0s));
        }

        /* ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á‡∏ï‡∏≤‡∏°‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‡πÄ‡∏Ç‡πâ‡∏≤ */
        .btn.‡πÄ‡∏Ç‡πâ‡∏≤.liquid { background: linear-gradient(#27ae60 0 0) no-repeat calc(200% - var(--p, 0%)) 100% / 200% var(--p, 0.2em); }
        /* ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ Liquid Fill ‡∏Ç‡∏≠‡∏á ‡∏≠‡∏≠‡∏Å ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏Ç‡πâ‡∏° */
        .btn.‡∏≠‡∏≠‡∏Å.liquid { background: linear-gradient(#c0392b 0 0) no-repeat calc(200% - var(--p, 0%)) 100% / 200% var(--p, 0.2em); }

        /* ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Hover ‡∏´‡∏£‡∏∑‡∏≠ Active */
        .liquid:hover, .liquid.active {
            --p: 100%; /* Fill background */
            --t: 0.3s; /* Transition time */
            color: #fff; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ Liquid Fill */
        }
        
        /* --- END Toggle Button Styling --- */


        /* File Input Styling */
        .file-upload-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-upload-wrapper input[type="file"] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
        }

        .file-upload-button {
            width: 100%;
            /* ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏ó‡∏∂‡∏ö */
            background: rgba(255, 255, 255, 0.9);
            color: #333; 
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            text-align: left;
            /* CHANGE: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô transition ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏ó‡∏∏‡∏Å property ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö focus */
            transition: all 0.3s ease; 
            display: flex;
            justify-content: space-between;
            align-items: center;
            /* Border default */
            border: 2px solid #e0e0e0;
        }

        /* NEW: Focus style ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå */
        .file-upload-wrapper:focus-within .file-upload-button {
            outline: none;
            background: white;
            border-color: #dc2743; /* Focus Border ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏Ç‡πâ‡∏° */
            box-shadow: 0 0 0 3px rgba(220, 39, 67, 0.3);
        }

        .file-upload-button:hover {
            background: white;
        }

        #file-name-display {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 80%;
        }

        /* Image Preview */
        #image-preview-container {
            margin-top: 15px;
            text-align: center;
            /* ‡πÄ‡∏™‡πâ‡∏ô‡∏õ‡∏£‡∏∞‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏°‡∏ö‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏ß */
            border: 2px dashed rgba(0, 0, 0, 0.3); 
            border-radius: 10px;
            padding: 10px;
            display: none;
            /* background ‡∏™‡∏µ‡∏≠‡πà‡∏≠‡∏ô */
            background: rgba(0, 0, 0, 0.05);
        }

        #image-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            object-fit: contain;
        }

        /* Submit Button */
        button[type="submit"] {
            width: 100%;
            padding: 14px;
            /* ‡πÉ‡∏ä‡πâ gradient ‡∏™‡∏µ‡πÅ‡∏î‡∏á/‡∏™‡πâ‡∏° */
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            color: white;
            border: none;
            border-radius: 10px;
            font-family: 'Prompt', sans-serif;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            /* ‡∏ô‡∏≥ Shadow ‡∏à‡∏≤‡∏Å index 20 ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÅ‡∏ï‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° */
            box-shadow: 0 4px 15px rgba(220, 39, 67, 0.4); 
        }

        button[type="submit"]:hover:not(:disabled) {
            transform: translateY(-2px);
            /* ‡∏ô‡∏≥ Shadow ‡∏à‡∏≤‡∏Å index 20 ‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡πÅ‡∏ï‡πà‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° */
            box-shadow: 0 6px 25px rgba(220, 39, 67, 0.6); 
            background: linear-gradient(45deg, #ff4b2b, #ff416c);
        }

        button[type="submit"]:active:not(:disabled) {
            transform: translateY(0);
        }

        button[type="submit"]:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Loading animation ‚öôÔ∏è */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1000;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #loading-overlay p {
            color: white;
            font-weight: 300;
            margin-top: 15px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô Studio 1</h1>
        
        <form id="registrationForm">

            <!-- 1. ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Toggle Button) -->
            <label for="type">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô <span>*</span></label>
            <div class="toggle-container" id="type-toggle-container">
                <button type="button" class="btn liquid ‡πÄ‡∏Ç‡πâ‡∏≤" data-value="‡πÄ‡∏Ç‡πâ‡∏≤" onclick="toggleActivate(this)"><span>‡πÄ‡∏Ç‡πâ‡∏≤</span></button>
                <button type="button" class="btn liquid ‡∏≠‡∏≠‡∏Å" data-value="‡∏≠‡∏≠‡∏Å" onclick="toggleActivate(this)"><span>‡∏≠‡∏≠‡∏Å</span></button>
                <input type="hidden" id="type" name="type" required>
            </div>
            
            <!-- 2. ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ -->
            <div class="form-group">
                <label for="studentId">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ <span>*</span></label>
                <!-- ‡πÉ‡∏ä‡πâ type="text" ‡πÅ‡∏•‡∏∞ pattern ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÅ‡∏•‡∏∞‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô error ‡∏à‡∏≤‡∏Å number input -->
                <input type="text" id="studentId" name="studentId" required pattern="[0-9]*" inputmode="numeric" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤">
            </div>

            <!-- 3. ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ -->
            <div class="form-group">
                <label for="phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ <span>*</span></label>
                <input type="tel" id="phone" name="phone" required pattern="[0-9]{10}" placeholder="08XXXXXXXX" maxlength="10">
            </div>

            <!-- 4. ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô -->
            <div class="form-group" id="count-group">
                <label for="count">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô <span>*</span></label>
                <input type="number" id="count" name="count" required min="1" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°/‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢">
            </div>

            <!-- 5. ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û -->
            <div class="form-group">
                <!-- REMOVED: <span>*</span> -->
                <label for="file">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (JPG/PNG ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10MB)</label>
                <div class="file-upload-wrapper">
                    <!-- REMOVED: required -->
                    <input type="file" id="file" name="file" accept=".jpg, .jpeg, .png" onchange="previewImage(event)">
                    <div class="file-upload-button">
                        <span id="file-name-display">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...</span>
                        <span style="font-size: 1.2em;">üìé</span>
                    </div>
                </div>
                <div id="image-preview-container">
                    <img id="image-preview" src="#" alt="Image Preview" style="display:none;">
                </div>
            </div>

            <button type="submit" id="submitBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </form>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="spinner"></div>
        <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
    </div>

    <!-- SweetAlert2 JS -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        // --- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ API & GAS (Hybrid Mode) ---
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyccfJLBCeKj09sZqRIHmf517SDmxzua2AMRM2OPxmiHMRi_gsg5U2axE6AuKDR4PMr/exec';
        
        // ** ID ‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß **
        const SPREADSHEET_ID = '1asnzno82tqBewq818eNzM7IxkhkOCwmdWFwrGXnkXrQ'; 

        const API_KEY = 'AIzaSyCa6APxh8sr1RPTlcZStt4UWnjXjZ-q8Vw'; 
        const DRIVE_FOLDER_ID = '1TJkdIIPDgsoYBwN3h7OHb-i5_ZrrP2qd';
        
        // --- ‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Alert ---
        function showSwal(icon, title, text) {
            Swal.fire({
                icon: icon,
                title: title,
                text: text,
                confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                customClass: {
                    container: 'prompt-font' // Custom class for font if needed
                }
            });
        }

        // --- Toggle Button Function ---
        function toggleActivate(btn) {
            const typeInput = document.getElementById('type');
            const countGroup = document.getElementById('count-group');
            const countInput = document.getElementById('count');
            const newValue = btn.getAttribute('data-value');
            
            if (btn.classList.contains('active')) {
                btn.classList.remove('active');
                typeInput.value = ''; 
                
                countGroup.style.display = 'block';
                countInput.required = true;

            } else {
                document.querySelectorAll('.toggle-container .btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                typeInput.value = newValue;

                if (newValue === '‡∏≠‡∏≠‡∏Å') {
                    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å '‡∏≠‡∏≠‡∏Å', ‡∏ã‡πà‡∏≠‡∏ô‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô 1 (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)
                    countGroup.style.display = 'none';
                    countInput.required = false;
                    countInput.value = 1; 
                } else {
                    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å '‡πÄ‡∏Ç‡πâ‡∏≤', ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Å‡∏£‡∏≠‡∏Å
                    countGroup.style.display = 'block';
                    countInput.required = true;
                }
            }
        }

        // --- Image Preview and File Validation ---
        function previewImage(event) {
            const fileInput = event.target;
            const file = fileInput.files[0];
            const previewContainer = document.getElementById('image-preview-container');
            const preview = document.getElementById('image-preview');
            const fileNameDisplay = document.getElementById('file-name-display');
            
            // Reset state
            preview.style.display = 'none';
            preview.src = '#';
            previewContainer.style.display = 'none';

            if (file) {
                fileNameDisplay.textContent = file.name;

                // 1. File size validation (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10 MB)
                const maxSize = 10 * 1024 * 1024;
                if (file.size > maxSize) {
                    showSwal('error', '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 10 MB');
                    fileInput.value = ''; 
                    fileNameDisplay.textContent = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...';
                    return;
                }

                // 2. File type validation (jpg/png ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
                const validTypes = ['image/jpeg', 'image/png'];
                if (!validTypes.includes(file.type)) {
                    showSwal('error', '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏ü‡∏•‡πå JPG ‡πÅ‡∏•‡∏∞ PNG ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
                    fileInput.value = ''; 
                    fileNameDisplay.textContent = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...';
                    return;
                }
                
                // Show preview
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    previewContainer.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                fileNameDisplay.textContent = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...';
            }
        }
        
        // --- Main Submission Handler ---
        document.getElementById('registrationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const form = e.target;
            const submitBtn = document.getElementById('submitBtn');
            const loadingOverlay = document.getElementById('loading-overlay');
            const fileInput = document.getElementById('file');
            
            // Disable button and show loading
            submitBtn.disabled = true;
            loadingOverlay.style.display = 'flex';

            // 1. Client-side Validation
            const type = document.getElementById('type').value;
            const phone = document.getElementById('phone').value;
            const file = fileInput.files[0];
            const studentId = document.getElementById('studentId').value;
            const count = document.getElementById('count').value;

            if (!type) {
                showSwal('error', '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
                hideLoadingAndEnableButton(submitBtn, loadingOverlay);
                return;
            }
            if (phone.length !== 10 || isNaN(phone)) {
                showSwal('error', '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 10 ‡∏´‡∏•‡∏±‡∏Å');
                hideLoadingAndEnableButton(submitBtn, loadingOverlay);
                return;
            }
            
            let fileBase64 = null;
            let fileName = null;
            let fileMimeType = null;

            try {
                // 2. File handling: Convert to base64 before sending to GAS
                if (file) {
                    const reader = new FileReader();
                    // Wrap FileReader in a Promise
                    fileBase64 = await new Promise((resolve, reject) => {
                        reader.onload = () => resolve(reader.result.split(',')[1]);
                        reader.onerror = () => reject(new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ'));
                        reader.readAsDataURL(file);
                    });
                    fileName = file.name;
                    fileMimeType = file.type;
                }

                const dataToSend = {
                    type,
                    studentId,
                    phone,
                    count: type === '‡∏≠‡∏≠‡∏Å' ? 1 : count, 
                    fileBase64,
                    fileName,
                    fileMimeType,
                    spreadsheetId: SPREADSHEET_ID,
                    sheetName: 'Studio 1', 
                    driveFolderId: DRIVE_FOLDER_ID
                };
                
                // 3. Send Data to Google Apps Script
                const result = await sendDataToAppsScript(dataToSend);
                
                // 4. Handle GAS Response
                if (result.success) {
                    showSwal('success', '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', result.message);
                    resetFormState(form, fileInput);
                } else {
                    showSwal('error', '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', result.message);
                }

            } catch (error) {
                console.error('Submission Error:', error);
                showSwal('error', '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á', error.message);
            }
            
            hideLoadingAndEnableButton(submitBtn, loadingOverlay);
        });
        
        // --- Helper Functions ---

        async function sendDataToAppsScript(data) {
            try {
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    body: JSON.stringify(data),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                // GAS doPost should return JSON
                return await response.json(); 
                
            } catch (error) {
                return { success: false, message: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Web App. ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£ Deploy' };
            }
        }

        function hideLoadingAndEnableButton(btn, loading) {
            loading.style.display = 'none';
            btn.disabled = false;
        }

        function resetFormState(form, fileInput) {
            form.reset();
            document.getElementById('type').value = '';
            
            document.querySelectorAll('.toggle-container .btn').forEach(b => b.classList.remove('active'));
            
            // Reset file preview
            fileInput.value = '';
            const previewContainer = document.getElementById('image-preview-container');
            const preview = document.getElementById('image-preview');
            const fileNameDisplay = document.getElementById('file-name-display');
            preview.style.display = 'none';
            preview.src = '#';
            previewContainer.style.display = 'none';
            fileNameDisplay.textContent = '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û...';
            
            // Reset count group state to default (visible and required)
            const countGroup = document.getElementById('count-group');
            const countInput = document.getElementById('count');
            countGroup.style.display = 'block';
            countInput.required = true;
        }

    </script>
</body>
</html>
